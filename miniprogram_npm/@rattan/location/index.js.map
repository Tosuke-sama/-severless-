{"version":3,"sources":["index.js"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["// 定位类型：国测局\r\nconst kLocationType = \"gcj02\"\r\n\r\n// =====================================\r\n// ============== 定位监控 ==============\r\n\r\n/// 结束定位监控\r\nfunction zmEndMonitor() {\r\n\t// #ifdef MP-WEIXIN\r\n\tconsole.log(\"========zmEnd\")\r\n\twx.offLocationChange(function(res) {\r\n\t\tzmLocationSuc(res)\r\n\t});\r\n\twx.offLocationChangeError(function(err) {\r\n\t\tzmLocationErr(err)\r\n\t});\r\n\t// #endif\r\n}\r\n\r\n// 判断是否获得了用户地理位置授权\r\nfunction zmStartMonitor() {\r\n\t// #ifdef MP-WEIXIN\r\n\treturn new Promise((resolve, reject) => {\r\n\t\twx.getSetting({\r\n\t\t\tsuccess: (res) => {\r\n\t\t\t\t// 查看位置权限的状态 如果是首次授权(undefined)或者之前拒绝授权(false)            \r\n\t\t\t\t//!res.authSetting['scope.userLocation']\r\n\t\t\t\tif (res.authSetting['scope.userLocation'] == false) {\r\n\t\t\t\t\t//之前拒绝授权(false)\r\n\t\t\t\t\tzmAuthorityOpen(false)\r\n\t\t\t\t\tzmOpenConfirm()\r\n\t\t\t\t} else {\r\n\t\t\t\t\t//如果是首次授权则弹出授权窗口进行授权，如果之前进行了授权，则获取地理位置信息\r\n\t\t\t\t\tzmBeginLocation()\r\n\t\t\t\t}\r\n\t\t\t\tresolve(res)\r\n\t\t\t},\r\n\t\t\tfail: (err) => {\r\n\t\t\t\tconsole.log(\"getSetting_err:\", JSON.stringify(err))\r\n\t\t\t\tzmAuthorityOpen(false)\r\n\t\t\t\treject(err)\r\n\t\t\t}\r\n\t\t})\r\n\t})\r\n\t// #endif\r\n}\r\n\n// 授权弹窗\r\nfunction zmOpenConfirm() {\r\n\t// #ifdef MP-WEIXIN\r\n\twx.showModal({\r\n\t\tcontent: '检测到您没打开定位权限，是否去设置打开？',\r\n\t\tconfirmText: \"确认\",\r\n\t\tcancelText: \"取消\",\r\n\t\tsuccess: function(res) {\r\n\t\t\tconsole.log(res);\r\n\t\t\t//点击“确认”时打开设置页面\r\n\t\t\tif (res.confirm) {\r\n\t\t\t\tconsole.log('用户点击确认')\r\n\t\t\t\twx.openSetting({\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tzmBeginLocation()\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t} else {\r\n\t\t\t\tconsole.log('用户点击取消')\r\n\t\t\t\tzmAuthorityOpen(false)\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\t// #endif\r\n}\r\n\r\n// 开启定位监听\r\nfunction zmBeginLocation() {\r\n\t// #ifdef MP-WEIXIN\r\n\twx.startLocationUpdate({\r\n\t\ttype: kLocationType,\r\n\t\tsuccess(res) {\r\n\t\t\tzmAuthorityOpen(true)\r\n\t\t\tconsole.log(\"startLocation_suc: \" + JSON.stringify(res));\r\n\t\t},\r\n\t\tfail(err) {\r\n\t\t\tzmAuthorityOpen(false)\r\n\t\t\tconsole.error(\"startLocation_err: \" + JSON.stringify(err));\r\n\t\t},\r\n\t})\r\n\twx.onLocationChange(function(res) {\r\n\t\tzmLocationSuc(res)\r\n\t});\r\n\twx.onLocationChangeError(function(res) {\r\n\t\tzmLocationErr(res)\r\n\t});\r\n\t// #endif\r\n}\r\n\r\n/// 监控定位信息成功\r\nfunction zmLocationSuc(res) {\r\n\t/* {\r\n\t\"latitude\":24.44579,\r\n\t\"longitude\":118.08243,\r\n\t\"speed\":-1,\r\n\t\"accuracy\":65,\r\n\t\"verticalAccuracy\":65,\r\n\t\"horizontalAccuracy\":65,\r\n\t\"errMsg\":\"getLocation:ok\"\r\n\t} */\r\n\tuni.$emit(\"iLocationSuc\", res)\r\n}\r\n\r\n/// 监控定位信息失败\r\nfunction zmLocationErr(err) {\r\n\tuni.$emit(\"iLocationErr\", err)\r\n}\r\n\r\n/// 监控定位权限开关\r\nfunction zmAuthorityOpen(e) {\r\n\tuni.$emit(\"iAuthorityOpen\", e)\r\n}\r\n\r\n// ==========================\r\n// ==========================\r\n\r\n/**\r\n * 获取本地经纬度\r\n */\r\nfunction zmLocation() {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tuni.getSetting({\r\n\t\t\tsuccess: (res) => {\r\n\t\t\t\t// 查看位置权限的状态 如果是首次授权(undefined)或者之前拒绝授权(false)            \r\n\t\t\t\t//!res.authSetting['scope.userLocation']\r\n\t\t\t\tif (res.authSetting['scope.userLocation'] == false) {\r\n\t\t\t\t\tuni.authorize({\r\n\t\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\t\t/// 获取当前的地理位置、速度。\r\n\t\t\t\t\t\t\tuni.getLocation({\r\n\t\t\t\t\t\t\t\ttype: 'gcj02',\r\n\t\t\t\t\t\t\t\tsuccess: function(res) {\r\n\t\t\t\t\t\t\t\t\tresolve(res)\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tfail: function(err) {\r\n\t\t\t\t\t\t\t\t\treject(err);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfail(err) {\r\n\t\t\t\t\t\t\treject(err);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t} else {\r\n\t\t\t\t\t//如果是首次授权则弹出授权窗口进行授权，如果之前进行了授权，则获取地理位置信息\r\n\t\t\t\t\t/// 获取当前的地理位置、速度。\r\n\t\t\t\t\tuni.getLocation({\r\n\t\t\t\t\t\ttype: 'gcj02',\r\n\t\t\t\t\t\tsuccess: function(res) {\r\n\t\t\t\t\t\t\tresolve(res)\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfail: function(err) {\r\n\t\t\t\t\t\t\treject(err);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t})\r\n}\r\n\r\nif (!exports.__esModule) Object.defineProperty(exports, \"__esModule\", { value: true });exports.default = {\r\n\tzmStartMonitor,\r\n\tzmEndMonitor,\r\n\tzmLocation,\r\n};\n"]}